---
lab:
  az204Title: 'Lab 09: Publish and subscribe to Event Grid events'
  az020Title: 'Lab 09: Publish and subscribe to Event Grid events'
  az204Module: 'Module 09: Develop event-based solutions'
  az020Module: 'Module 09: Develop event-based solutions'
---

# <a name="lab-09-publish-and-subscribe-to-event-grid-events"></a>ラボ 09: Event Grid イベントの発行とサブスクライブ

## <a name="microsoft-azure-user-interface"></a>Microsoft Azure ユーザー インターフェイス

Given the dynamic nature of Microsoft cloud tools, you might experience Azure UI changes that occur after the development of this training content. As a result, the lab instructions and lab steps might not align correctly.

Microsoft updates this training course when the community alerts us to needed changes. However, cloud updates occur frequently, so you might encounter UI changes before this training content updates. <bpt id="p1">**</bpt>If this occurs, adapt to the changes, and then work through them in the labs as needed.<ept id="p1">**</ept>

## <a name="instructions"></a>Instructions

### <a name="before-you-start"></a>開始する前に

#### <a name="sign-in-to-the-lab-environment"></a>ラボ環境にサインインする

次のサインイン情報を使用して、Windows 10 仮想マシン (VM) にサインインします。

- ユーザー名: **Admin**

- パスワード: **Pa55w.rd**

> **注**: 仮想ラボ環境に接続するための手順は、講師が説明します。

#### <a name="review-the-installed-applications"></a>インストールされているアプリケーションを確認する

Find the taskbar on your Windows 10 desktop. The taskbar contains the icons for the applications that you'll use in this lab, including:

- Microsoft Edge

- Microsoft Visual Studio Code

## <a name="architecture-diagram"></a>アーキテクチャの図

![ユーザーによる Event Grid イベントの発行とサブスクライブを示すアーキテクチャの図。](./media/Lab09-Diagram.png)

### <a name="exercise-1-create-azure-resources"></a>演習 1: Azure リソースを作成する

#### <a name="task-1-open-the-azure-portal"></a>タスク 1: Azure portal を開く

1. タスク バーで、**Microsoft Edge** アイコンを選択します。

1. 開いたブラウザー ウィンドウで、Azure portal (<https://portal.azure.com>) にアクセスしてから、このラボで使用するアカウントでサインインします。

    > Microsoft クラウド ツールの動的な性質を考慮すると、このトレーニング コンテンツの開発の後に発生する Azure UI の変更に気付くかもしれません。

#### <a name="task-2-open-azure-cloud-shell"></a>タスク 2: Azure Cloud Shell を開く

1. その結果、ラボの指示とラボの手順が正しく整合しなくなる可能性があります。

    > <bpt id="p1">**</bpt>Note<ept id="p1">**</ept>: If this is the first time you are starting <bpt id="p2">**</bpt>Cloud Shell<ept id="p2">**</ept>, when prompted to select either <bpt id="p3">**</bpt>Bash<ept id="p3">**</ept> or <bpt id="p4">**</bpt>PowerShell<ept id="p4">**</ept>, select <bpt id="p5">**</bpt>Bash<ept id="p5">**</ept>. When you are presented with the <bpt id="p1">**</bpt>You have no storage mounted<ept id="p1">**</ept> message, select the subscription you are using in this lab, and then select <bpt id="p2">**</bpt>Create storage<ept id="p2">**</ept>.

1. Azure portal の **Cloud Shell** コマンド プロンプトで次のコマンドを実行して、Azure コマンド ライン インターフェイス (Azure CLI) ツールのバージョンを取得します。

    ```bash
    az --version
    ```

#### <a name="task-3-review-the-microsofteventgrid-provider-registration"></a>タスク 3: Microsoft EventGrid プロバイダーの登録を確認する

1. **[Cloud Shell]** ペインで、次のコマンドを実行して、Azure CLI のルート レベルのサブグループとコマンドの一覧を取得します。

    ```bash
    az --help
    ```

1. **[Cloud Shell]** ペインで、次のコマンドを実行して、リソース プロバイダーで使用できるコマンドの一覧を取得します。

    ```bash
    az provider --help
    ```

1. **[Cloud Shell]** ペインで、次のコマンドを実行して、現在登録されているすべてのプロバイダーを一覧表示します。

    ```bash
    az provider list
    ```

1. **[Cloud Shell]** ペインで、次のコマンドを実行して、現在登録されているプロバイダーの名前空間のみを一覧表示します。

    ```bash
    az provider list --query "[].namespace"
    ```

1. Microsoft は、コミュニティから必要な変更の通知があったときに、このトレーニング コースを更新します。

1. **[Cloud Shell]** ペインを閉じます。

#### <a name="task-4-create-a-custom-event-grid-topic"></a>タスク 4: カスタム Event Grid トピックを作成する

1. Azure portal のナビゲーション ウィンドウで **[リソースの作成]** を選択します。

1. **[リソースの作成]** ブレードで、**[サービスとマーケットプレースの検索]** テキスト ボックスに「**Event Grid トピック**」と入力し、Enter キーを押します。

1. **[Marketplace](マーケットプレース)** 検索結果ブレードで "**Event Grid トピック**" という結果を選択し、 **[作成]** を選択します。

1. **[トピックの作成]** ブレードの **[基本]** タブで、次のアクションを実行してから、 **[詳細]** タブを選択します。

    | 設定 | アクション |
    | -- | -- |
    | **[サブスクリプション]** ドロップダウン リスト  | 既定値のままにします |
    | **[リソース グループ]** ドロップダウン リスト | **[新規作成]** を選択し、「**PubSubEvents**」と入力して、 **[OK]** を選択します |
    | **[名前]** テキスト ボックス | 「**hrtopic** _[ご自分の名前]_ 」と入力します |
    | **[リージョン]** ドロップダウン リスト | **[米国東部]** を選択します。 |

   次のスクリーンショットには、 **[基本]** タブに構成されている設定が示されています。

   ![[トピックの作成] ブレードで構成された設定を示すスクリーンショット](./media/l09_create_topic.png)

1. **[詳細]** タブで、 **[イベント スキーマ]** ドロップダウン リストから **[イベント グリッド スキーマ]** を選択し、 **[確認と作成]** を選択します。

1. **[確認と作成]** タブで、前の手順で選択したオプションを確認します。

1. **[作成]** を選択し、指定した構成を使用して Event Grid トピックを作成します。
  
    > ただし、クラウドの更新は頻繁に発生するため、このトレーニング コンテンツの更新の前に UI の変更に気付く可能性があります。

#### <a name="task-5-deploy-the-azure-event-grid-viewer-to-a-web-app"></a>タスク 5: Web アプリに Azure Event Grid ビューアーをデプロイする

1. Azure portal のナビゲーション ウィンドウで **[リソースの作成]** を選択します。

1. **[リソースの作成]** ブレードで、**[サービスとマーケットプレースの検索]** テキスト ボックスに「**Web アプリ**」と入力し、Enter キーを押します。

1. **[Marketplace](マーケットプレース)** 検索結果ブレードで "**Web アプリ**" という結果を選択し、 **[作成]** を選択します。

1. **[Web アプリの作成]** ブレードの **[基本]** タブで、次のアクションを実行してから、 **[次へ: Docker]** を選択します。

   | 設定 | アクション |
   | -- | -- |
   | **[サブスクリプション]** ドロップダウン リスト | 既定値のままにします |
   | **[リソース グループ]** ドロップダウン リスト | リストで **[PubSubEvents]** を選択します。 |
   | **[名前]**  テキスト ボックス | 「**eventviewer** _[ご自分の名前]_ 」と入力します |
   | **[公開]** セクション | **[Docker コンテナー]** を選択します |
   | **[オペレーティング システム]** セクション | **[Linux]** を選択します |
   | **[リージョン]** ドロップダウン リスト | **[米国東部] を選択します。 |
   | **[Linux Plan (East US)](Linux プラン (米国東部))** セクション | **[新規作成]** を選択し、 **[名前]** テキスト ボックスに「**EventPlan**」と入力して、 **[OK]** を選択します |
   | **[SKU とサイズ]** セクション | 既定値のままにします |

   次のスクリーンショットは、 **[Web アプリの作成]** ブレードで構成されている設定を示しています。

   ![[Web アプリの作成] ブレードで構成された設定を示すスクリーンショット](./media/l09_create_web_app.png)

1. **[Docker]** タブで、次のアクションを実行し、 **[確認と作成]** を選択します。

    | 設定 | アクション |
    | -- | -- |
    | **[オプション]** ドロップダウン リスト | **[単一コンテナー]** を選択します |
    | **[イメージのソース]** ドロップダウン リスト | **[Docker Hub]** を選択します |
    | **[アクセスの種類]** ドロップダウン リスト | **[Public]** を選択します |
    | **[イメージとタグ]** テキスト ボックス | 「**microsoftlearning/azure-event-grid-viewer:latest**」と入力します |

   次のスクリーンショットには、 **[Docker]** タブに構成されている設定が示されています。

   ![[Web アプリの作成] の [Docker] タブで構成された設定を示すスクリーンショット](./media/l09_create_web_app_docker.png)

1. **[確認と作成]** タブで、前の手順で選択したオプションを確認します。

1. **[作成]** を選択し、指定した構成を使用して Web アプリを作成します。
  
    > **これが発生した場合は、その変更に適応し、ラボでは必要に応じてそれらに対応してください。**

#### <a name="review"></a>確認

この演習では、ラボの残りの部分で使用する、Event Grid トピックと Web アプリを作成しました。

### <a name="exercise-2-create-an-event-grid-subscription"></a>演習 2: Event Grid サブスクリプションを作成する

#### <a name="task-1-access-the-event-grid-viewer-web-application"></a>タスク 1: Event Grid ビューアー Web アプリにアクセスする

1. Azure portal のナビゲーション ウィンドウで **[リソース グループ]** を選択します。

1. **[リソース グループ]** ブレードで、**PubSubEvents** リソース グループを選択します。

1. **[PubSubEvents]** ブレードで、"**eventviewer** _[自分の名前]_ "Web アプリを選択します。

1. **[App Service]** ブレードの **[設定]** カテゴリで、 **[プロパティ]** リンクを選択します。

1. In the <bpt id="p1">**</bpt>Properties<ept id="p1">**</ept> section, record the value of the <bpt id="p2">**</bpt>URL<ept id="p2">**</ept> link. You'll use this value later in the lab.

1. **[概要]** を選択し、 **[参照]** を選択します。

1. Observe the currently running <bpt id="p1">**</bpt>Azure Event Grid Viewer<ept id="p1">**</ept> web application. Leave this web application running for the remainder of the lab.

    > <bpt id="p1">**</bpt>Note<ept id="p1">**</ept>: This web application will update in real time as events are sent to its endpoint. You'll use this application to monitor events throughout the lab.

1. Azure portal を表示する、現在開いているブラウザー ウィンドウに戻ります。

#### <a name="task-2-create-a-new-subscription"></a>タスク 2: 新しいサブスクリプションを作成する

1. Azure portal のナビゲーション ウィンドウで **[リソース グループ]** を選択します。

1. **[リソース グループ]** ブレードで、このラボで先ほど作成した **PubSubEvents** リソース グループを選択します。

1. **[PubSubEvents]** ブレードで、このラボで先ほど作成した **hrtopic** _[自分の名前]_ Event Grid トピックを選択します。

1. **[Event Grid トピック]** ブレードで、 **[+ イベント サブスクリプション]** を選択します。

1. **[イベント サブスクリプションの作成]** ブレードで、次のアクションを実行し、 **[作成]** を選択します。

    | 設定 | アクション |
    | -- | -- |
    | **[名前]**  テキスト ボックス | 「**basicsub**」と入力します |
    | **[イベント スキーマ]** ドロップダウン リスト | **[Event Grid スキーマ]** を選択します |
    | **[エンドポイントの種類]** ドロップダウン リスト | **[Web hook]** を選択します |
    | **エンドポイント** | Select <bpt id="p1">**</bpt>Select an endpoint<ept id="p1">**</ept>. In the <bpt id="p1">**</bpt>Subscriber Endpoint<ept id="p1">**</ept> text box, enter the <bpt id="p2">**</bpt>Web App URL<ept id="p2">**</ept> value that you recorded previously, ensure that it uses an <bpt id="p3">**</bpt>https://<ept id="p3">**</ept> prefix, add the suffix <bpt id="p4">**</bpt>/api/updates<ept id="p4">**</ept>, and then select <bpt id="p5">**</bpt>Confirm Selection<ept id="p5">**</ept>. For example, if your <bpt id="p1">**</bpt>Web App URL<ept id="p1">**</ept> value is <ph id="ph1">``http://eventviewerstudent.azurewebsites.net/``</ph>, then your <bpt id="p2">**</bpt>Subscriber Endpoint<ept id="p2">**</ept> would be <ph id="ph2">``https://eventviewerstudent.azurewebsites.net/api/updates``</ph> |

   次のスクリーンショットには、 **[イベント サブスクリプションの作成]** ブレードに構成されている設定が示されています。

   ![[イベント サブスクリプションの作成] ブレードで構成された設定を示すスクリーンショット](./media/l09_create_event_subscription.png)

    > <bpt id="p1">**</bpt>Note<ept id="p1">**</ept>: Wait for Azure to finish creating the subscription before you continue with the lab. You'll receive a notification when the subscription is created.

#### <a name="task-3-observe-the-subscription-validation-event"></a>タスク 3: サブスクリプション検証イベントを確認する

1. **Azure Event Grid ビューアー** Web アプリを表示しているブラウザー ウィンドウに戻ります。

1. サブスクリプション作成プロセスの一環で作成された、**Microsoft.EventGrid.SubscriptionValidationEvent** イベントを確認します。

1. イベントを選択し、その JSON コンテンツを確認します。

1. Azure portal がある、現在開いているブラウザー ウィンドウに戻ります。

#### <a name="task-4-record-subscription-credentials"></a>タスク 4: サブスクリプションの資格情報を記録する

1. Azure portal のナビゲーション ウィンドウで **[リソース グループ]** を選択します。

1. **[リソース グループ]** ブレードで、このラボで先ほど作成した **PubSubEvents** リソース グループを選択します。

1. **[PubSubEvents]** ブレードで、このラボで先ほど作成した **hrtopic** _[自分の名前]_ Event Grid トピックを選択します。

1. On the <bpt id="p1">**</bpt>Event Grid Topic<ept id="p1">**</ept> blade, record the value of the <bpt id="p2">**</bpt>Topic Endpoint<ept id="p2">**</ept> field. You'll use this value later in the lab.

1. **[設定]** カテゴリで、 **[アクセス キー]** リンクを選択します。

1. In the <bpt id="p1">**</bpt>Access keys<ept id="p1">**</ept> section, record the value of the <bpt id="p2">**</bpt>Key 1<ept id="p2">**</ept> text box. You'll use this value later in the lab.

#### <a name="review"></a>確認

この演習では、新しいサブスクリプションを作成し、その登録を検証し、トピックに新しいイベントを発行するために必要な資格情報を記録しました。

### <a name="exercise-3-publish-event-grid-events-from-net"></a>演習 3: .NET から Event Grid イベントを発行する

#### <a name="task-1-create-a-net-project"></a>タスク 1: .NET プロジェクトを作成する

1. **[スタート]** 画面で、 **[Visual Studio Code]** タイルを選択します。

1. **[ファイル]** メニューの **[フォルダーを開く]** を選択します。

1. 開いた**エクスプローラー**のウィンドウで、"**Allfiles (F):\\Allfiles\\Labs\\09\\Starter\\EventPublisher**" を参照し、 **[フォルダーの選択]** を選択します。

1. **[Visual Studio Code]** ウィンドウで、 **[エクスプローラー]** ペインのショートカット メニューをアクティブにし、 **[統合ターミナルで開く]** を選択します。

1. 次のコマンドを実行して、現在のフォルダーに **EventPublisher** という名前の新しい .NET プロジェクトを作成します。

    ```powershell
    dotnet new console --framework net6.0 --name EventPublisher --output . 
    ```

    > **注**: **dotnet new** コマンドは、プロジェクトと同じ名前のフォルダーに新しい**コンソール** プロジェクトを作成します。

1. 次のコマンドを実行して、NuGet から **Azure.Messaging.EventGrid** のバージョン 4.10.0 をインポートします。

    ```powershell
    dotnet add package Azure.Messaging.EventGrid --version 4.10.0
    ```

    > <bpt id="p1">**</bpt>Note<ept id="p1">**</ept>: The <bpt id="p2">**</bpt>dotnet add package<ept id="p2">**</ept> command will add the <bpt id="p3">**</bpt>Microsoft.Azure.EventGrid<ept id="p3">**</ept> package from NuGet. For more information, go to <bpt id="p1">[</bpt>Azure.Messaging.EventGrid<ept id="p1">](https://www.nuget.org/packages/Azure.Messaging.EventGrid/4.10.0)</ept>.

1. 次のコマンドを実行して、.NET Web アプリをビルドします。

    ```powershell
    dotnet build
    ```

1. **[ターミナルの強制終了]** または**ごみ箱** アイコンを選択して、現在開いているターミナルおよび関連プロセスを閉じます。

#### <a name="task-2-modify-the-program-class-to-connect-to-event-grid"></a>タスク 2: Event Grid に接続するように Program クラスを変更する

1. **[Visual Studio Code]** ウィンドウの **[エクスプローラー]**  ペインで、**Program.cs** ファイルを開きます。

1.  **Program.cs** ファイルのコード エディター タブで、既存のファイルのすべてのコードを削除します。

1. **Azure** と、NuGet からインポートした **Azure.Messaging.EventGrid** パッケージからの **Azure.Messaging.EventGrid** の名前空間をインポートするために、次のコード行を追加します。

    ```csharp
    using Azure;
    using Azure.Messaging.EventGrid;
    ```

1. このファイルで使用される組み込みの名前空間に対して **using** ディレクティブを追加するために、次のコード行を追加します。

    ```csharp
    using System;
    using System.Threading.Tasks;
    ```

1. 新しい **Program** クラスを作成するために、次のコードを入力します。

    ```csharp
    public class Program
    {
    }
    ```

1. **Program** クラスで、**topicEndpoint** という名前の新しい文字列定数を作成するために、次のコード行を入力します。

    ```csharp
    private const string topicEndpoint = "";
    ```

1. このラボで前に記録しておいた Event Grid トピックの **トピック エンドポイント**を値として設定することで、**topicEndpoint** 文字列定数を更新します。

1. **Program** クラスで、**topicKey** という名前の新しい文字列定数を作成するために、次のコード行を入力します。

    ```csharp
    private const string topicKey = "";
    ```

1. このラボで前に記録しておいた Event Grid トピックの **キー**を値として設定することで、**topicKey** 文字列定数を更新します。

1. **Program** クラスで、新しい非同期の **Main** メソッドを作成するために、次のコードを入力します。

    ```csharp
    public static async Task Main(string[] args)
    {
    }
    ```

1. **Program.cs** ファイルを確認します。次のコード行が含まれているはずです。

    ```csharp
    using Azure;
    using Azure.Messaging.EventGrid;
    using System;
    using System.Threading.Tasks;    
    public class Program
    {
        private const string topicEndpoint = "<topic-endpoint>";
        private const string topicKey = "<topic-key>";        
        public static async Task Main(string[] args)
        {
        }
    }
    ```

#### <a name="task-3-publish-new-events"></a>タスク 3: 新しいイベントを発行する

1. **Main** メソッドで、次のアクションを実行してイベントの一覧をトピック エンドポイントに発行します。

    a. Add the following line of code to create a new variable named <bpt id="p1">**</bpt>endpoint<ept id="p1">**</ept> of type <bpt id="p2">**</bpt>Uri<ept id="p2">**</ept>, using the <bpt id="p3">**</bpt>topicEndpoint<ept id="p3">**</ept> string constant as a constructor parameter:

    ```csharp
    Uri endpoint = new Uri(topicEndpoint); 
    ```

    Windows 10 デスクトップでタスク バーを見つけます。

    ```csharp
    AzureKeyCredential credential = new AzureKeyCredential(topicKey);
    ```

    タスク バーには、このラボで使用する次のようなアプリケーションのアイコンが含まれています。

    ```csharp
    EventGridPublisherClient client = new EventGridPublisherClient(endpoint, credential);
    ```

    d. Add the following block of code to create a new variable named <bpt id="p1">**</bpt>firstEvent<ept id="p1">**</ept> of type <bpt id="p2">**</bpt><bpt id="p3">[</bpt>EventGridEvent<ept id="p3">](https://docs.microsoft.com/dotnet/api/azure.messaging.eventgrid.eventgridevent)</ept><ept id="p2">**</ept> and populate that variable with sample data:

    ```csharp
    EventGridEvent firstEvent = new EventGridEvent(
        subject: $"New Employee: Alba Sutton",
        eventType: "Employees.Registration.New",
        dataVersion: "1.0",
        data: new
        {
            FullName = "Alba Sutton",
            Address = "4567 Pine Avenue, Edison, WA 97202"
         }
     );
     ```

    e. Add the following block of code to create a new variable named <bpt id="p1">**</bpt>secondEvent<ept id="p1">**</ept> of type <bpt id="p2">**</bpt><bpt id="p3">[</bpt>EventGridEvent<ept id="p3">](https://docs.microsoft.com/dotnet/api/azure.messaging.eventgrid.eventgridevent)</ept><ept id="p2">**</ept> and populate that variable with sample data:

     ```csharp
        EventGridEvent secondEvent = new EventGridEvent(
            subject: $"New Employee: Alexandre Doyon",
            eventType: "Employees.Registration.New",
            dataVersion: "1.0",
            data: new
            {
                FullName = "Alexandre Doyon",
                Address = "456 College Street, Bow, WA 98107"
            }
        );
     ```

    f. Add the following line of code to asynchronously invoke the <bpt id="p1">**</bpt><bpt id="p2">[</bpt>EventGridPublisherClient.SendEventAsync<ept id="p2">](https://docs.microsoft.com/dotnet/api/azure.messaging.eventgrid.eventgridpublisherclient.sendeventasync)</ept><ept id="p1">**</ept> method using the <bpt id="p3">**</bpt>firstEvent<ept id="p3">**</ept> variable as a parameter:

     ```csharp
     await client.SendEventAsync(firstEvent);
     ```

    g. Add the following line of code to render the <bpt id="p1">**</bpt>"First event published"<ept id="p1">**</ept> message to the console:

     ```csharp
     Console.WriteLine("First event published");
     ```

    h. Add the following line of code to asynchronously invoke the <bpt id="p1">**</bpt><bpt id="p2">[</bpt>EventGridPublisherClient.SendEventAsync<ept id="p2">](https://docs.microsoft.com/dotnet/api/azure.messaging.eventgrid.eventgridpublisherclient.sendeventasync)</ept><ept id="p1">**</ept> method using the <bpt id="p3">**</bpt>secondEvent<ept id="p3">**</ept> variable as a parameter:

     ```csharp
     await client.SendEventAsync(secondEvent);
     ```

    i. Add the following line of code to render the <bpt id="p1">**</bpt>"Second event published"<ept id="p1">**</ept> message to the console:

     ```csharp
     Console.WriteLine("Second event published");
     ```

1. **Main** メソッドを確認します。次のような内容のはずです。

    ```csharp
    public static async Task Main(string[] args)
    {
        Uri endpoint = new Uri(topicEndpoint);
        AzureKeyCredential credential = new AzureKeyCredential(topicKey);
        EventGridPublisherClient client = new EventGridPublisherClient(endpoint, credential);        
        EventGridEvent firstEvent = new EventGridEvent(
            subject: $"New Employee: Alba Sutton",
            eventType: "Employees.Registration.New",
            dataVersion: "1.0",
            data: new
            {
                FullName = "Alba Sutton",
                Address = "4567 Pine Avenue, Edison, WA 97202"
            }
        );
        EventGridEvent secondEvent = new EventGridEvent(
            subject: $"New Employee: Alexandre Doyon",
            eventType: "Employees.Registration.New",
            dataVersion: "1.0",
            data: new
            {
                FullName = "Alexandre Doyon",
                Address = "456 College Street, Bow, WA 98107"
            }
        );
        await client.SendEventAsync(firstEvent);
        Console.WriteLine("First event published");
        await client.SendEventAsync(secondEvent);
        Console.WriteLine("Second event published");
    }
    ```

1.  **Program.cs** ファイルを保存します。

1. **[Visual Studio Code]** ウィンドウで、 **[エクスプローラー]** ペインのショートカット メニューをアクティブにし、 **[統合ターミナルで開く]** を選択します。

1. 次のコマンドを実行して、.NET Web アプリを実行します。

    ```powershell
    dotnet run
    ```

    > **注**: ビルド エラーが発生した場合は、**Allfiles (F):\\Allfiles\\Labs\\09\\Solution\\EventPublisher** フォルダーにある **Program.cs** ファイルを確認してください。

1. 現在実行中のコンソール アプリケーションからの成功メッセージの出力を確認します。

1. **[ターミナルの強制終了]** または**ごみ箱** アイコンを選択して、現在開いているターミナルおよび関連プロセスを閉じます。

#### <a name="task-4-observe-published-events"></a>タスク 4: 発行されたイベントを確認する

1. **Azure Event Grid ビューアー** Web アプリがあるブラウザー ウィンドウに戻ります。

1. コンソール アプリケーションによって作成された **Employees.Registration.New** イベントを確認します。

1. 任意のイベントを選択し、その JSON コンテンツを確認します。

1. Azure Portal に戻ります。

#### <a name="review"></a>確認

この演習では、.NET コンソール アプリケーションを使用して、Event Grid トピックに新しいイベントを発行しました。

### <a name="exercise-4-clean-up-your-subscription"></a>演習 4: サブスクリプションをクリーンアップする

#### <a name="task-1-open-azure-cloud-shell"></a>タスク 1: Azure Cloud Shell を開く

1. In the Azure portal, select the <bpt id="p1">**</bpt>Cloud Shell<ept id="p1">**</ept> icon <ph id="ph1">![</ph>Cloud Shell icon<ph id="ph2">](./media/az204_lab_CloudShell.png)</ph> to open a new Bash session. If Cloud Shell defaults to a PowerShell session, select <bpt id="p1">**</bpt>PowerShell<ept id="p1">**</ept> and, in the drop-down menu, select <bpt id="p2">**</bpt>Bash<ept id="p2">**</ept>.

    > <bpt id="p1">**</bpt>Note<ept id="p1">**</ept>: If this is the first time you are starting <bpt id="p2">**</bpt>Cloud Shell<ept id="p2">**</ept>, when prompted to select either <bpt id="p3">**</bpt>Bash<ept id="p3">**</ept> or <bpt id="p4">**</bpt>PowerShell<ept id="p4">**</ept>, select <bpt id="p5">**</bpt>PowerShell<ept id="p5">**</ept>. When you are presented with the <bpt id="p1">**</bpt>You have no storage mounted<ept id="p1">**</ept> message, select the subscription you are using in this lab, and select <bpt id="p2">**</bpt>Create storage<ept id="p2">**</ept>.

#### <a name="task-2-delete-a-resource-group"></a>タスク 2: リソース グループを削除する

1. **[Cloud Shell]** ペインで、次のコマンドを実行して、**PubSubEvents** リソース グループを削除します。

    ```bash
    az group delete --name PubSubEvents --no-wait --yes
    ```

     > **注**: このコマンドは非同期で実行されるため ( *--no-wait* パラメーターによって決定されます)、同じ Bash セッション内で直後に別の Azure CLI コマンドを実行できますが、リソース グループが実際に削除されるまでに数分かかります。

1. portal の **[Cloud Shell]** ペインを閉じます。

#### <a name="task-3-close-the-active-applications"></a>タスク 3: アクティブなアプリケーションを閉じる

1. 現在実行中の Microsoft Edge アプリケーションを閉じます。

1. 現在実行中の Visual Studio Code アプリケーションを終了します。

#### <a name="review"></a>確認

この演習では、このラボで使用されたリソース グループを削除することによってサブスクリプションをクリーンアップしました。
