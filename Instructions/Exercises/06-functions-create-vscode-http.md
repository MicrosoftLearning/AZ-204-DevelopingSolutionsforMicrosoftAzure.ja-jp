---
lab:
  title: Visual Studio Code で Azure 関数を作成する
  description: HTTP トリガーを使用して Azure 関数を作成する方法について説明します。 Visual Studio Code でコードをローカルに作成しテストしたら、その関数を Azure にデプロイします。
---

# Visual Studio Code で Azure 関数を作成する

この演習では、HTTP 要求に応答する C\# 関数を作成する方法を学習します。 Visual Studio Code でコードをローカルに作成しテストしたら、その関数を Azure でデプロイしテストします。

この演習で実行されるタスク:

* コンテナ化されたアプリの Azure App Service リソースを作成する
* 結果を確認する
* リソースをクリーンアップする

この演習の所要時間は約 **30** 分です。

## 開始する前に

開始する前に、以下の要件が満たされていることを確認してください。

* Azure サブスクリプション。 まだお持ちでない場合は、[Microsoft Azure にサインアップ](https://azure.microsoft.com/)できます。

* [Azure Functions Core Tools](https://github.com/Azure/azure-functions-core-tools#installing) バージョン 4.x。

* [サポートされているプラットフォーム](https://code.visualstudio.com/docs/supporting/requirements#_platforms)のいずれかにインストールされた [Visual Studio Code](https://code.visualstudio.com/)。

* [.NET 8](https://dotnet.microsoft.com/en-us/download/dotnet/8.0) はターゲット フレームワークです。

* Visual Studio Code 用の [C# 開発キット](https://marketplace.visualstudio.com/items?itemName=ms-dotnettools.csdevkit)

* Visual Studio Code 用 [Azure Functions 拡張機能](https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-azurefunctions)。

## ローカル プロジェクトを作成する

このセクションでは、Visual Studio Code を使用して、ローカル Azure Functions プロジェクトを C# で作成します。 この演習の後半で、関数コードを Azure に発行します。

1. Visual Studio Code で F1 キーを押してコマンド パレットを開き、コマンド `Azure Functions: Create New Project...` を検索して実行します。

1. プロジェクト ワークスペースのディレクトリの場所を選択し、**選択** を選択します。 新しいフォルダーを作成するか、プロジェクト ワークスペースの空のフォルダーを選択する必要があります。 ワークスペースに最初から含まれているプロジェクト フォルダーは選択しないでください。

1. プロンプトで、次の情報を入力します。

    | プロンプト | アクション |
    |--|--|
    | 関数プロジェクトを含んだォルダーを選択します | **[参照...]** を選択して、アプリのフォルダーを選択します。
    | 言語を選択する | **[C#]** を選択します。 |
    | Select a .NET runtime (.NET ランタイムを選択してください) | **[.NET 8.0 (分離)]** を選択します。 |
    | Select a template for your project's first function (プロジェクトの最初の関数のテンプレートを選択してください) | **[HTTP トリガー]** を選択します。<sup>1</sup> |
    | Provide a function name (関数名を指定してください) | 「`HttpExample`」と入力します。 |
    | Provide a namespace (名前空間を指定してください) | 「`My.Function`」と入力します。 |
    | 承認レベル | **[匿名]** を選択します。これにより、すべてのユーザーが関数エンドポイントを呼び出せるようになります。 |

    <sup>1</sup> VS Code の設定によっては、**[テンプレート フィルターの変更]** オプションを使用して、テンプレートの完全な一覧を表示する必要がある場合があります。

1. Visual Studio Code は、提供された情報を使用し、HTTP トリガーを含む Azure Functions プロジェクトを生成します。 ローカル プロジェクト ファイルは、エクスプローラーで表示できます。

### 関数をローカルで実行する

Visual Studio Code を Azure Functions Core Tools と統合することで、このプロジェクトをローカルの開発用コンピューター上で実行してから、Azure に発行することができます。

1. Visual Studio Code でターミナルが開いていることを確認します。 ターミナルを開くには、**[ターミナル]**、次いでメニュー バーの **[新しいターミナル]** を選択します。 

1. **F5** キーを押してデバッガーで関数アプリ プロジェクトを起動します。 Core Tools からの出力が**ターミナル** パネルに表示されます。 アプリが**ターミナル** パネルで起動します。 HTTP によってトリガーされる関数の URL エンドポイントがローカルで実行されていることを確認できます。

    ![HTTP トリガー関数のエンドポイントが [ターミナル] パネルに表示される様子を示すスクリーンショット。](./media/06/run-function-local.png)

1. Core Tools を実行したまま、**Azure: Functions** 領域に移動します。 **[Functions]** の **[ローカル プロジェクト]** > **[Functions]** を展開します。 **HttpExample** 関数を右クリックし、**[Execute Function Now...] (今すぐ関数を実行...)** を選択します。

    ![[Execute Function Now...] (今すぐ関数を実行...) ステップの場所を示すスクリーンショット。](./media/06/execute-function-local.png)

1. **[Enter request body] (要求本文を入力してください)** に、`{ "name": "Azure" }` という要求メッセージ本文値を入力します。 **Enter** キーを押して、この要求メッセージを関数に送信します。 ローカルで関数を実行し、応答が返されると、Visual Studio Code で通知が発生します。

    通知ベル アイコンを選択して、通知を表示します。 関数の実行に関する情報は、 **[ターミナル]** パネルに表示されます。

1. **Shift + F5** キーを押して Core Tools を停止し、デバッガーの接続を解除します。

関数がローカル コンピューター上で正常に動作することを確認したら、Visual Studio Code を使用してプロジェクトを直接 Azure に発行します。

## Azure で関数をデプロイして実行する

このセクションでは、Azure 関数アプリ リソースを作成し、そのリソースに関数をデプロイします。

### Azure へのサインイン

アプリを発行するには、Azure にサインインしておく必要があります。 既にサインインしている場合は、次のセクションに進んでください。

1. まだサインインしていない場合は、[アクティビティ] バーの Azure アイコンを選択し、**[Azure: Functions]** 領域で、**[Azure にサインイン...]** を選択します。

    ![[Azure にサインイン] ボタンのスクリーンショット。](./media/06/functions-sign-into-azure.png)

1. ブラウザーでプロンプトが表示されたら、ご利用の Azure アカウントを選択し、その Azure アカウントの資格情報を使用してサインインします。

1. 正常にサインインしたら、新しいブラウザー ウィンドウを閉じてかまいません。 ご利用の Azure アカウントに属しているサブスクリプションがサイド バーに表示されます。

### Azure でリソースを作成する

このセクションでは、ローカル関数アプリをデプロイするために必要な Azure リソースを作成します。

1. アクティビティ バーの Azure アイコンを選択し、**[リソース]** 領域で **[リソースの作成]** ボタンを選択します。

    ![「リソースの作成」ボタンのスクリーンショット。](./media/06/create-resource.png)    

1. プロンプトで、次の情報を入力します。

    | プロンプト | アクション |
    |--|--|
    | 作成するリソースを選択する | **[Azure で関数アプリを作成する]** を選択します。 |
    | サブスクリプションを選択してください | 使用するサブスクリプションを選択します。 *サブスクリプションが 1 つのみの場合、このプロンプトは表示されません。* |
    | 関数アプリのグローバルに一意の名前を入力してください | URL パスに有効な名前 (例: `myfunctionapp`) を入力します。 入力した名前は検証されて、一意であることが確認されます。 |
    | Select a location for new resources (新しいリソースの場所を選択してください) | パフォーマンスを向上させるために、お近くのリージョンを選択してください。 |
    | ランタイム スタックを選択してください | **[.NET 8.0 (分離)]** を選択します。 |
    | インスタンスのメモリ サイズを選択します。 | **2048** (既定値) を選びます。 |
    | 最大インスタンス数を選択します。 | 既定値 **100** のままにします。 |

    この拡張機能は、作成される個々のリソースの状態をターミナル ウィンドウの **[AZURE]** 領域に表示します。
    
1. 完了すると、関数アプリ名に基づく名前を使用して、次の Azure リソースがサブスクリプションに作成されます。

    * リソース グループ。関連リソースの論理コンテナーです。
    * Standard Azure ストレージ アカウント。プロジェクトについての状態とその他の情報を保持します。
    * Flex 従量課金プラン。サーバーレス関数アプリの実行環境となるホストを定義します。
    * 関数アプリ。関数コードを実行するための環境となります。 関数アプリを使用すると、同じホスティング プランに含まれるリソースの管理、デプロイ、共有を容易にするための論理ユニットとして関数をグループ化できます。
    * 関数アプリに接続された Application Insights インスタンス。サーバーレス関数の使用を追跡します。

### Azure にプロジェクトをデプロイする

> **重要:** 既存の関数に発行すると、以前のデプロイはすべて上書きされます。

1. コマンド パレットで、**Azure Functions: Deploy to Function App...** を検索して実行します。

1. リソースの作成時に使用したサブスクリプションを選択します。

1. 作成した関数アプリを選びます。 前のデプロイの上書きを求められたら、**[デプロイ]** を選択して、関数コードを新しい関数アプリ リソースにデプロイします。

1. デプロイの完了後、**[出力の表示]** を選択すると、デプロイ結果の詳細が表示されます。 通知を見逃した場合は、右下隅にある通知ベル アイコンを選択して、再度確認します。

    ![[出力の表示] ボタンのスクリーンショット。](./media/06/function-view-output.png)

### Azure で関数を実行する

1. **[リソース]** 領域 (サイド バー内) に戻り、サブスクリプション、新しい関数アプリ、**[関数]** の順に展開します。 **HttpExample** 関数を**右クリック**し、**[Execute function now...] (今すぐ関数を実行...)** を選択します。

    ![[Execute function now...] (今すぐ関数を実行...) オプションのスクリーンショット。](./media/06/execute-function-remote.png)

1. **[Enter request body]\(要求本文を入力してください\)** に、要求メッセージ本文の値として `{ "name": "Azure" }` が表示されます。 Enter キーを押して、この要求メッセージを関数に送信します。

1. Azure で関数を実行し、応答が返されると、Visual Studio Code で通知が発生します。 通知ベル アイコンを選択して、通知を表示します。

## リソースをクリーンアップする

これで演習が完了したので、不要なリソース使用を避けるために、作成したクラウド リソースを削除してください。

1. お使いのブラウザーで Azure portal ([https://portal.azure.com](https://portal.azure.com)) に移動し、メッセージに応じて Azure 資格情報を使用してサインインします。
1. 作成したリソース グループに移動し、この演習で使用したリソースの内容を表示します。
1. ツール バーの **[リソース グループの削除]** を選びます。
1. リソース グループ名を入力し、削除することを確認します。
